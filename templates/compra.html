<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout – UniMarket</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css')}}">
<script src="{{ url_for('static', filename='js/accesibilidad.js')}}"></script>
<style>
    body { font-family: Arial, sans-serif; background:#0f172a; color:#e5e7eb; padding:20px; }
    .container { max-width:600px; margin:auto; background:#111827; padding:20px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35);}
    h1 { text-align:center; color:#22c55e;}
    label { display:block; margin-top:15px; }
    input, select { width:100%; padding:10px; margin-top:5px; border-radius:8px; border:1px solid #94a3b8; background:#1f2937; color:#e5e7eb;}
    .btn { background:linear-gradient(135deg,#22c55e,#38bdf8); border:none; padding:12px; border-radius:12px; color:#111827; font-weight:800; width:100%; margin-top:20px; cursor:pointer;}
    .btn-back { background:#ef4444; margin-top:10px; }
</style>
</head>
<body>

<div class="container">
    <h1>Finalizar Compra</h1>

    <form id="checkoutForm" method="POST" action="/procesar_compra">
        
        <div id="cartSummary"></div>

        <label for="pago">Método de pago</label>
        <select id="pago" name="pago" required>
            <option value="tarjeta">Tarjeta</option>
            <option value="efectivo">Efectivo</option>
            <option value="mercadopago">Mercado Pago</option>
        </select>

        <div id="tarjetaFields">
            <label>Número de tarjeta</label>
            <input type="text" name="tarjeta" placeholder="XXXX-XXXX-XXXX-XXXX" pattern="\d{4}-\d{4}-\d{4}-\d{4}">
            
            <label>CVV</label>
            <input type="text" name="cvv" pattern="\d{3}" placeholder="123">
        </div>

        <label for="turno">Turno</label>
        <select id="turno" name="turno" required>
            <option value="">-- Selecciona un turno --</option>
            <option value="matutino">Matutino</option>
            <option value="vespertino">Vespertino</option>
        </select>

        <label>Horas disponibles</label>
        <div id="horasContainer">
            <label data-turno="matutino"><input type="checkbox" name="horas" value="10:00"> 10:00</label>
            <label data-turno="matutino"><input type="checkbox" name="horas" value="11:00"> 11:00</label>
            <label data-turno="matutino"><input type="checkbox" name="horas" value="12:00"> 12:00</label>
            <label data-turno="matutino"><input type="checkbox" name="horas" value="13:00"> 13:00</label>

            <label data-turno="vespertino"><input type="checkbox" name="horas" value="14:00"> 14:00</label>
            <label data-turno="vespertino"><input type="checkbox" name="horas" value="15:00"> 15:00</label>
            <label data-turno="vespertino"><input type="checkbox" name="horas" value="16:00"> 16:00</label>
            <label data-turno="vespertino"><input type="checkbox" name="horas" value="17:00"> 17:00</label>
            <label data-turno="vespertino"><input type="checkbox" name="horas" value="18:00"> 18:00</label>
        </div>

        <input type="hidden" id="cartData" name="cartData">

        <button type="submit" class="btn">Confirmar Compra</button>
        <button type="button" class="btn btn-back" onclick="window.history.back()">Regresar</button>
    </form>
</div>

<script>
const turnoSelect = document.getElementById('turno');
const horasContainer = document.getElementById('horasContainer');
const pagoSelect = document.getElementById('pago');
const tarjetaFields = document.getElementById('tarjetaFields');
const summary = document.getElementById('cartSummary');
const cartDataInput = document.getElementById('cartData');

function actualizarHoras() {
    const turno = turnoSelect.value;
    document.querySelectorAll('#horasContainer label').forEach(label => {
        const visible = label.dataset.turno === turno;
        const input = label.querySelector('input');

        label.style.display = visible ? 'block' : 'none';
        input.disabled = !visible;
        if (!visible) input.checked = false;
    });
}
turnoSelect.addEventListener('change', actualizarHoras);
actualizarHoras();


function actualizarCamposPago() {
    tarjetaFields.style.display = pagoSelect.value === 'tarjeta' ? 'block' : 'none';
}
pagoSelect.addEventListener('change', actualizarCamposPago);
actualizarCamposPago();


const cart = JSON.parse(localStorage.getItem('cart')) || [];

if (cart.length === 0) {
    summary.innerHTML = '<p>Tu carrito está vacío.</p>';
} else {
    let total = 0;
    let html = "<h3>Resumen de compra</h3><ul>";

    cart.forEach(item => {
        html += `<li>${item.name} – $${item.price.toFixed(2)} x ${item.quantity}</li>`;
        total += item.price * item.quantity;
    });

    html += `</ul><p><strong>Total: $${total.toFixed(2)}</strong></p>`;
    summary.innerHTML = html;
}

cartDataInput.value = JSON.stringify(cart);

document.getElementById('checkoutForm').addEventListener('submit', () => {
    localStorage.removeItem('cart');
});
</script>

</body>
</html>
