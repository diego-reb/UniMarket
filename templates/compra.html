<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout – UniMarket</title>
<style>
    body { font-family: Arial, sans-serif; background:#0f172a; color:#e5e7eb; padding:20px; }
    .container { max-width:600px; margin:auto; background:#111827; padding:20px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35);}
    h1 { text-align:center; color:#22c55e;}
    label { display:block; margin-top:15px; }
    input, select { width:100%; padding:10px; margin-top:5px; border-radius:8px; border:1px solid #94a3b8; background:#1f2937; color:#e5e7eb;}
    .btn { background:linear-gradient(135deg,#22c55e,#38bdf8); border:none; padding:12px; border-radius:12px; color:#111827; font-weight:800; width:100%; margin-top:20px; cursor:pointer;}
    .btn-back { background:#ef4444; margin-top:10px; }
</style>
</head>
<body>
<div class="container">
    <h1>Finalizar Compra</h1>
    <form id="checkoutForm" method="POST" action="/procesar_compra">
        <div id="cartSummary"></div>

        <label for="pago">Método de pago</label>
        <select id="pago" name="pago" required>
            <option value="tarjeta">Tarjeta</option>
            <option value="efectivo">Efectivo</option>
        </select>

        <div id="tarjetaFields">
            <label for="tarjeta">Número de tarjeta</label>
            <input type="text" id="tarjeta" name="tarjeta" placeholder="XXXX-XXXX-XXXX-XXXX" pattern="\d{4}-\d{4}-\d{4}-\d{4}">

            <label for="cvv">CVV</label>
            <input type="text" id="cvv" name="cvv" pattern="\d{3}" placeholder="123">
        </div>

        <label for="turno">Turno</label>
        <select id="turno" name="turno" required>
            <option value="matutino">Matutino</option>
            <option value="vespertino">Vespertino</option>
        </select>

        <label for="horas">Horas disponibles (puedes seleccionar más de una)</label>
        <select id="horas" name="horas" multiple required>
            <option value="08:00">08:00</option>
            <option value="09:00">09:00</option>
            <option value="10:00">10:00</option>
            <option value="15:00">15:00</option>
            <option value="16:00">16:00</option>
            <option value="17:00">17:00</option>
        </select>

        <input type="hidden" id="cartData" name="cartData">

        <button type="submit" class="btn">Confirmar Compra</button>
        <button type="button" class="btn btn-back" onclick="window.history.back()">Regresar</button>
    </form>
</div>

<script>
    // Traer carrito desde sessionStorage
    const cart = JSON.parse(sessionStorage.getItem('checkoutCart')) || [];
    const summary = document.getElementById('cartSummary');
    const cartDataInput = document.getElementById('cartData');

    if(cart.length === 0){
        summary.innerHTML = '<p>Tu carrito está vacío.</p>';
    } else {
        let html = '<h3>Resumen de compra</h3><ul>';
        let total = 0;
        cart.forEach(item => {
            html += `<li>${item.name} - $${item.price.toFixed(2)} x ${item.quantity}</li>`;
            total += item.price * item.quantity;
        });
        html += `</ul><p><strong>Total a pagar: $${total.toFixed(2)}</strong></p>`;
        summary.innerHTML = html;

        cartDataInput.value = JSON.stringify(cart);
    }

    // Mostrar campos de tarjeta solo si se selecciona tarjeta
    const pagoSelect = document.getElementById('pago');
    const tarjetaFields = document.getElementById('tarjetaFields');
    pagoSelect.addEventListener('change', () => {
        tarjetaFields.style.display = pagoSelect.value === 'tarjeta' ? 'block' : 'none';
    });
    tarjetaFields.style.display = pagoSelect.value === 'tarjeta' ? 'block' : 'none';
</script>
</body>
</html>
